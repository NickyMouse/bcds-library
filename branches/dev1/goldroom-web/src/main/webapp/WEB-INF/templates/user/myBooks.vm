<script type="text/javascript" src="$SERVER_NAME/js/datePicker.js"></script>

#parse("widget/pageNav.vm")
<table style="width: 80%;margin:auto;" cellspacing="3" cellpadding="0" border="0">
	<tbody>
		<tr height="15px" valign="middle"><td>&nbsp;&nbsp;&nbsp;&nbsp;
		<select id="stateFilter" onchange="javascript:changeFilter();">
			<option value="">全部</option>
			<option value="reservated" #if($state &&$state.equals("reservated"))selected="true"#end>被预约</option>
			<option value="lended" #if($state &&$state.equals("lended"))selected="true"#end>被借阅</option>
		</select>
		</td></tr>
		#foreach($bookItem in $bookItemList)
		<tr height="170" valign="middle">
			<td class="lines" align="left" valign="middle">

				<div onmouseover="javascript:this.style.background='#F7F7F7'" onmouseout="javascript:this.style.background=''" style="width=100%;">
					<table>
					<tr  valign="middle">
						<td width="150px" align="center">
							<a href="$SERVER_NAME/user/bookDetail.htm?id=$!{bookItem.bookInfo.id}" title="" target="_blank">
								#if($bookItem.bookInfo.imgUrl && !$bookItem.bookInfo.getImgUrl().equals(""))
									<img id="bookCoverImage" class="bookImage" src="$UPLOAD_IMAGE_PATH/$bookItem.bookInfo.ImgUrl"/>
								#else
									<img id="bookCoverImage" class="bookImage" src="$SERVER_NAME/images/noPhoto.png"/>
								#end
							</a>
						</td>
						<td width="600px" valign="top" style="font-size:16px; color:#89A945;">
							<h2>
							<a href="$SERVER_NAME/user/bookDetail.htm?id=$!{bookItem.bookInfo.id}" title="" target="_blank">
								$!{bookItem.bookInfo.name}
							</a></h2>
							作　　者：$bookItem.bookInfo.author  <br/>
							ＩＳＢＮ：$bookItem.bookInfo.isbn  <br/>
							版　　本：$bookItem.bookInfo.edition	 <br/>
							出版时间：$dateTool.format("yyyy-MM-dd",$bookItem.bookInfo.publishTime)  <br/>
							标　　签：$bookItem.tags <br/>
						</td>
						<td valign="middle" align="right" width="220px" style="font-size:16px; color:#89A945;">
							<br/>
							#if($bookItem.state== "lended")
								借阅者：$!{bookItem.lending.subscriber}
							#end
							#if($bookItem.state == "reservated")
								预约者：$!{bookItem.reservation.subscriber}
								<br/>
								预约时间：${bookItem.reservation.lendTime}~${bookItem.reservation.returnTime}
							#end
							<br/>
							#if($bookItem.state== "lended")
								<table onClick="javascript:returnBook($!{bookItem.lending.id});" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_dark_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		确认归还
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            	</tbody></table>
						
							#end
							#if($bookItem.state == "reservated")
								<input type="text" id="returnTime_$!{bookItem.reservation.id}" onfocus="setday(this)"/>
								<table onClick="javascript:confirmLend($!{bookItem.reservation.id});" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_dark_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		确认借阅
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            	</tbody></table>
							#end
							
						</td>
    				</tr>
					</table>		
				</div>
				
			</td>
			
		</tr>
		#end
</tbody>
</table>

#parse("widget/pageNav.vm")
<form action="/user/confirmLend.htm" name="confirmLendForm" method="POST">
	<input type="hidden" name="reservationId" />
	<input type="hidden" name="returnTime"/>
</form>

<form action="/user/returnBook.htm" name="returnBookForm" method="POST">
	<input type="hidden" name="lendingId" />
</form>
	
<script>
<!--
function confirmLend(reservationId){
	document.confirmLendForm.reservationId.value=reservationId;
	document.confirmLendForm.returnTime.value=document.getElementById("returnTime_"+reservationId).value;
	document.confirmLendForm.submit();
}

function returnBook(lendingId){
	document.returnBookForm.lendingId.value=lendingId;
	document.returnBookForm.submit();
}

function changeFilter(){	
	window.location.href="$SERVER_NAME/user/myBooks.htm?state=" + document.getElementById("stateFilter").value;;
}
-->
</script>