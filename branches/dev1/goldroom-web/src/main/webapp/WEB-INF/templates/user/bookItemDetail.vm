#if($bookItem)
#set($bookInfo=$bookItem.bookInfo)
#parse("widget/bookInfoDetail.vm")

<table style="width: 80%;margin:auto;" cellspacing="3" cellpadding="0" border="0">
	<tbody>
	<tr height="170" valign="middle">
			<td class="lines" align="left" valign="middle">

				<div onmouseover="javascript:this.style.background='#F7F7F7'" onmouseout="javascript:this.style.background=''" style="width=100%;">
					<table>
					<tr  valign="middle">
						<td width="150px" align="center">
							<a href="$SERVER_NAME/user/bookDetail.htm?id=$!{bookItem.bookInfo.id}" title="" target="_blank">
								书本编号：$!{bookItem.id}
							</a>
						</td>
						<td width="300px" valign="top" style="font-size:16px; color:#89A945;">
							上架日期：$dateTool.format("yyyy-MM-dd",$bookItem.addTime)  <br/>
							
						</td>
						<td width="300px" valign="top" style="font-size:16px; color:#89A945;">
							当前状态：
							#if($bookItem.state== "idle")
									闲置
							#elseif($bookItem.state== "reservated")
								被预约
							#elseif($bookItem.state== "lended")
								被借阅
							#elseif($bookItem.state== "unavailable")
								已下架
							#end
							#if($bookItem.state != "unavailable" && $bookItem.state != "lended")
							<table onClick="offShelves('$bookItem.id','$bookItem.bookInfo.name')" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_warn_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		书籍下架
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            </tbody></table>
							#elseif($bookItem.state == "unavailable")
							<table onClick="reputOnShelves('$bookItem.id','$bookItem.bookInfo.name')" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_dark_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		重新上架
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            </tbody></table>
							#end
							
                        </td>
						<td valign="top" align="right" width="220px" style="font-size:16px; color:#89A945;">
							
							
							#if($bookItem.state== "lended")
								借阅者：$!{bookItem.lending.subscriber}
							#elseif($bookItem.state == "reservated")
								预约者：$!{bookItem.reservation.subscriber}
								<br/>
								预约时间：$!dateTool.format("yyyy-MM-dd",$!{bookItem.reservation.lendTime}) 至 $!dateTool.format("yyyy-MM-dd",$!{bookItem.reservation.returnTime})
							#end
							
							#if($bookItem.state== "lended")
								<table onClick="javascript:returnBook($!{bookItem.lending.id});" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_dark_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		确认归还
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            	</tbody></table>
							#elseif($bookItem.state == "reservated")
								##<input type="text" id="returnTime_$!{bookItem.reservation.id}" onfocus="setday(this)"/>
								<table onClick="javascript:confirmLend($!{bookItem.reservation.id});" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_dark_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		确认借阅
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            	</tbody></table>
								<br/>
								<table onClick="javascript:rejectLending($!{bookItem.reservation.id});" style="cursor: pointer;" border="0" cellpadding="0" cellspacing="0">	
                            	<tbody><tr>
                            		<td><img src="$SERVER_NAME/images/button_warn_left.gif" border="0"></td>
                            		<td class="button_dark">
                            		拒绝借阅
                            		</td>
                            		<td><img src="$SERVER_NAME/images/button_dark_right.gif" border="0"></td>		
                            	</tr>
                            	</tbody></table>
							#end
							
						</td>
    				</tr>
					</table>		
				</div>
				
			</td>
			
		</tr>
		</tbody>
</table>
<form action="/user/confirmLend.htm" name="confirmLendForm" method="POST">
	<input type="hidden" name="reservationId" />
	##<input type="hidden" name="returnTime"/>
</form>

<form action="/user/returnBook.htm" name="returnBookForm" method="POST">
	<input type="hidden" name="lendingId" />
</form>
<form action="/user/offShelves.htm" name="offShelvesForm" method="POST">
	<input type="hidden" name="bookItemId">
</form>

<form action="/user/reputOnShelves.htm" name="reputOnShelvesForm" method="POST">
	<input type="hidden" name="bookItemId">
</form>

<form action="/user/rejectLending.htm" name="rejectLendingForm" method="POST">
	<input type="hidden" name="reservationId">
</form>

<script>
<!--
function confirmLend(reservationId){
	document.confirmLendForm.reservationId.value=reservationId;
	//document.confirmLendForm.returnTime.value=document.getElementById("returnTime_"+reservationId).value;
	document.confirmLendForm.submit();
}

function rejectLending(reservationId){
	document.rejectLendingForm.reservationId.value=reservationId;
	//document.confirmLendForm.returnTime.value=document.getElementById("returnTime_"+reservationId).value;
	document.rejectLendingForm.submit();
}

function returnBook(lendingId){
	document.returnBookForm.lendingId.value=lendingId;
	document.returnBookForm.submit();
}

function offShelves(bookItemId, bookName){
	if(confirm("确定将\""+bookName +"\" 下架?")){
		document.offShelvesForm.bookItemId.value=bookItemId;
		document.offShelvesForm.submit();
	}else {
		return false;
	}
}
function reputOnShelves(bookItemId, bookName){
	if(confirm("确定将 \""+bookName +"\" 重新上架?")){
		document.reputOnShelvesForm.bookItemId.value=bookItemId;
		document.reputOnShelvesForm.submit();
	}else {
		return false;
	}
}

-->
</script>
#end